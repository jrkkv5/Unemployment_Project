---
title: "BLS_Compensation_Requests"
author: "https://github.com/jrkkv5/FIN6572Fall2020/blob/master/National%20Debt/importNationalDebt.Rmd"
date: "10/24/2020"
output: html_document
---
```{r packages}
library(devtools)
library(blsAPI)
library(rjson)
library(curl)
library(dplyr)
library(tidyverse)
```

See example 2 at <https://github.com/mikeasilva/blsAPI> and adapt code.

Note: Create your own API key at <https://data.bls.gov/registrationEngine/> and insert the key they email you as the registration key parameter.

Pull the data via the API:
```{r import_AL}
unemp_AL = data.frame()
startyear = 1948
endyear = 1957
nreq = ceiling((2020-1948)/10)
for (i in 1:nreq){
  if(endyear > 2020){
    endyear = 2020
  }
  payload <- list(
  'seriesid'=c('NBU10000000000000028007'),
  'startyear'=startyear,
  'endyear'=endyear,
  'registrationkey'="01f3421bc9504301b5c0de6951908ef3")
  response <- blsAPI(payload, 2)
  json <- fromJSON(response)
  apiDF <- function(data){
    df <- data.frame(year=character(),
                     period=character(),
                     periodName=character(),
                     value=character(),
                     stringsAsFactors=FALSE)
    i <- 0
    for(d in data){
      i <- i + 1
      df[i,] <- unlist(d)
    }
    return(df)
  }
  unemppart <- apiDF(json$Results$series[[1]]$data)
  unemp_MO = rbind(unemp_MO,unemppart)
  startyear=startyear+10
  endyear=endyear+10
}
index <- with(unemp_MO, order(year, period))
unemp = unemp_MO[index, ]
#https://www.bls.gov/help/hlpforma.htm#SM
#Pulls Unemployment data from BLS on state of MO for applicable years
```



```{r import_MO}
unemp_MO = data.frame()
startyear = 1948
endyear = 1957
nreq = ceiling((2020-1948)/10)
for (i in 1:nreq){
  if(endyear > 2020){
    endyear = 2020
  }
  payload <- list(
  'seriesid'=c('NBU10000000000000028007'),
  'startyear'=startyear,
  'endyear'=endyear,
  'registrationkey'="01f3421bc9504301b5c0de6951908ef3")
  response <- blsAPI(payload, 2)
  json <- fromJSON(response)
  apiDF <- function(data){
    df <- data.frame(year=character(),
                     period=character(),
                     periodName=character(),
                     value=character(),
                     stringsAsFactors=FALSE)
    i <- 0
    for(d in data){
      i <- i + 1
      df[i,] <- unlist(d)
    }
    return(df)
  }
  unemppart <- apiDF(json$Results$series[[1]]$data)
  unemp_MO = rbind(unemp_MO,unemppart)
  startyear=startyear+10
  endyear=endyear+10
}
index <- with(unemp_MO, order(year, period))
unemp = unemp_MO[index, ]
#https://www.bls.gov/help/hlpforma.htm#SM
#Pulls Unemployment data from BLS on state of MO for applicable years
```