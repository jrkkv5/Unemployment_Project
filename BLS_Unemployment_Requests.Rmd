---
title: "BLS_Unemployment_Requests"
author: "https://github.com/jrkkv5/FIN6572Fall2020/blob/master/National%20Debt/importNationalDebt.Rmd"
date: "10/24/2020"
output: html_document
---
```{r packages}
library(devtools)
library(blsAPI)
library(rjson)
library(curl)
library(dplyr)
library(tidyverse)
```

See example 2 at <https://github.com/mikeasilva/blsAPI> and adapt code.

Note: Create your own API key at <https://data.bls.gov/registrationEngine/> and insert the key they email you as the registration key parameter.

Pull the data via the API: 
```{r import_MO}
unemp_MO = data.frame()
startyear = 1948
endyear = 1957
nreq = ceiling((2020-1948)/10)
for (i in 1:nreq){
  if(endyear > 2020){
    endyear = 2020
  }
  payload <- list(
  'seriesid'=c('LAUST290000000000003'),
  'startyear'=startyear,
  'endyear'=endyear,
  'registrationkey'="01f3421bc9504301b5c0de6951908ef3")
  response <- blsAPI(payload, 2)
  json <- fromJSON(response)
  apiDF <- function(data){
    df <- data.frame(year=character(),
                     period=character(),
                     periodName=character(),
                     value=character(),
                     stringsAsFactors=FALSE)
    i <- 0
    for(d in data){
      i <- i + 1
      df[i,] <- unlist(d)
    }
    return(df)
  }
  unemppart <- apiDF(json$Results$series[[1]]$data)
  unemp_MO = rbind(unemp_MO,unemppart)
  startyear=startyear+10
  endyear=endyear+10
}
index <- with(unemp_MO, order(year, period))
unemp = unemp_MO[index, ]
#https://www.bls.gov/help/hlpforma.htm#SM
#Pulls Unemployment data from BLS on state of MO for applicable years
```

```{r import_WA}
unemp_WA = data.frame()
startyear = 1948
endyear = 1957
nreq = ceiling((2020-1948)/10)
for (i in 1:nreq){
  if(endyear > 2020){
    endyear = 2020
  }
  payload <- list(
  'seriesid'=c('LAUST530000000000003'),
  'startyear'=startyear,
  'endyear'=endyear,
  'registrationkey'="01f3421bc9504301b5c0de6951908ef3")
  response <- blsAPI(payload, 2)
  json <- fromJSON(response)
  apiDF <- function(data){
    df <- data.frame(year=character(),
                     period=character(),
                     periodName=character(),
                     value=character(),
                     stringsAsFactors=FALSE)
    i <- 0
    for(d in data){
      i <- i + 1
      df[i,] <- unlist(d)
    }
    return(df)
  }
  unemppart <- apiDF(json$Results$series[[1]]$data)
  unemp_WA = rbind(unemp_WA,unemppart)
  startyear=startyear+10
  endyear=endyear+10
}
index <- with(unemp_WA, order(year, period))
unemp_WA = unemp_WA[index, ]
#https://www.bls.gov/help/hlpforma.htm#SM
#Pulls Unemployment data from BLS on state of WA for applicable years
```

```{r import_WV}
unemp_WV = data.frame()
startyear = 1948
endyear = 1957
nreq = ceiling((2020-1948)/10)
for (i in 1:nreq){
  if(endyear > 2020){
    endyear = 2020
  }
  payload <- list(
  'seriesid'=c('LAUST540000000000003'),
  'startyear'=startyear,
  'endyear'=endyear,
  'registrationkey'="01f3421bc9504301b5c0de6951908ef3")
  response <- blsAPI(payload, 2)
  json <- fromJSON(response)
  apiDF <- function(data){
    df <- data.frame(year=character(),
                     period=character(),
                     periodName=character(),
                     value=character(),
                     stringsAsFactors=FALSE)
    i <- 0
    for(d in data){
      i <- i + 1
      df[i,] <- unlist(d)
    }
    return(df)
  }
  unemppart <- apiDF(json$Results$series[[1]]$data)
  unemp_WV = rbind(unemp_WV,unemppart)
  startyear=startyear+10
  endyear=endyear+10
}
index <- with(unemp_WV, order(year, period))
unemp_WV = unemp_WV[index, ]
#https://www.bls.gov/help/hlpforma.htm#SM
#Pulls Unemployment data from BLS on state of WV for applicable years
```
```{r import_LA}
unemp_LA = data.frame()
startyear = 1948
endyear = 1957
nreq = ceiling((2020-1948)/10)
for (i in 1:nreq){
  if(endyear > 2020){
    endyear = 2020
  }
  payload <- list(
  'seriesid'=c('LAUST220000000000003'),
  'startyear'=startyear,
  'endyear'=endyear,
  'registrationkey'="01f3421bc9504301b5c0de6951908ef3")
  response <- blsAPI(payload, 2)
  json <- fromJSON(response)
  apiDF <- function(data){
    df <- data.frame(year=character(),
                     period=character(),
                     periodName=character(),
                     value=character(),
                     stringsAsFactors=FALSE)
    i <- 0
    for(d in data){
      i <- i + 1
      df[i,] <- unlist(d)
    }
    return(df)
  }
  unemppart <- apiDF(json$Results$series[[1]]$data)
  unemp_LA = rbind(unemp_LA,unemppart)
  startyear=startyear+10
  endyear=endyear+10
}
index <- with(unemp_LA, order(year, period))
unemp_LA = unemp_LA[index, ]
#https://www.bls.gov/help/hlpforma.htm#SM
#Pulls Unemployment data from BLS on state of LA for applicable years
```


``` {r format_dataframes}
colnames(unemp_MO)[which(names(unemp_MO) == "value")] <- "MO_Unemployment"
colnames(unemp_MO)[which(names(unemp_MO) == "periodName")] <- "month"
#renames columns with month and unemployment data for Missouri

colnames(unemp_WA)[which(names(unemp_WA) == "value")] <- "WA_Unemployment"
colnames(unemp_WA)[which(names(unemp_WA) == "periodName")] <- "month"
#renames columns with month and unemployment data for Washington

colnames(unemp_WV)[which(names(unemp_WV) == "value")] <- "WV_Unemployment"
colnames(unemp_WV)[which(names(unemp_WV) == "periodName")] <- "month"
#renames columns with month and unemployment data for West Virginia

colnames(unemp_LA)[which(names(unemp_LA) == "value")] <- "LA_Unemployment"
colnames(unemp_LA)[which(names(unemp_LA) == "periodName")] <- "month"
#renames columns with month and unemployment data for Washington

```
``` {r Overall_Unemployment}
temp1 <- left_join(unemp_MO,unemp_WA)
temp2 <- left_join(temp1,unemp_LA)
unemp_overall <- left_join(temp2, unemp_WV)
#Joins unemployment from all states in question into a single dataframe
```
